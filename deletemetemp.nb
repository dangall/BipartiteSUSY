(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     52624,       1337]
NotebookOptionsPosition[     51703,       1305]
NotebookOutlinePosition[     52045,       1320]
CellTagsIndexPosition[     52002,       1317]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "This", " ", "is", " ", "code", " ", "from", " ", "stackexchange", " ", 
     RowBox[{"http", ":"}]}], "//", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"mathematica", ".", "stackexchange", ".", "com"}], "/", 
        "questions"}], "/", "18514"}], "/", "finding"}], "-", "face", "-", 
     "vertices", "-", "from", "-", "the", "-", "face", "-", "adjacency", "-", 
     RowBox[{
     "graph", " ", "for", " ", "counting", " ", "the", " ", "number", " ", 
      "of", " ", "faces"}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "===", "===", "===", "===", "===", "===", "===", "===", "===", "===", "===",
      "===", "===", "===", "==="}], "=", 
    RowBox[{
     RowBox[{
     "===", "===", "===", "===", "===", "===", "===", "===", "===", "===", 
      "==="}], "=", 
     RowBox[{"===", "===", "===", "===", "===", "===", "===", "=="}]}]}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"nextCandidate", "[", 
      RowBox[{"s_", ",", "t_", ",", "adj_"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"length", ",", "pos"}], "}"}], ",", 
       RowBox[{
        RowBox[{"length", "=", 
         RowBox[{"Length", "[", "adj", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pos", "=", 
         RowBox[{"Mod", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Position", "[", 
              RowBox[{"adj", ",", "s"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}], "+", "1"}], ",", 
           "length", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"t", ",", 
          RowBox[{"adj", "[", 
           RowBox[{"[", "pos", "]"}], "]"}]}], "}"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FindFace", "[", 
      RowBox[{"g_", "?", "PlanarGraphQ"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", "emb", "}"}], ",", 
       RowBox[{
        RowBox[{"emb", "=", 
         RowBox[{"GraphEmbedding", "[", 
          RowBox[{"g", ",", "\"\<PlanarEmbedding\>\""}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"FindFace", "[", 
         RowBox[{"g", ",", "emb"}], "]"}]}]}], "]"}]}], ";"}], "\n", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"FindFace", "[", 
     RowBox[{
      RowBox[{"g_", "?", "PlanarGraphQ"}], ",", "emb_"}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "m", ",", "realvertexlist", ",", "fakevertexlist", ",", "tofakenums", 
        ",", "torealnums", ",", "orderings", ",", "pAdj", ",", "rightF", ",", 
        "s", ",", "t", ",", "initial", ",", "face", ",", "answers", ",", 
        "outputfaces"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"m", "=", 
        RowBox[{"AdjacencyMatrix", "[", "g", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"realvertexlist", "=", 
        RowBox[{"VertexList", "[", "g", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"fakevertexlist", "=", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "realvertexlist", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tofakenums", "=", 
        RowBox[{"MapThread", "[", 
         RowBox[{"Rule", ",", 
          RowBox[{"{", 
           RowBox[{"realvertexlist", ",", "fakevertexlist"}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"torealnums", "=", 
        RowBox[{"Map", "[", 
         RowBox[{"Reverse", ",", "tofakenums"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"pAdj", "[", "v", "]"}], "=", 
          RowBox[{"SortBy", "[", 
           RowBox[{
            RowBox[{"Pick", "[", 
             RowBox[{"fakevertexlist", ",", 
              RowBox[{"m", "[", 
               RowBox[{"[", "v", "]"}], "]"}], ",", "1"}], "]"}], ",", 
            RowBox[{
             RowBox[{"ArcTan", "@@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"emb", "[", 
                 RowBox[{"[", "v", "]"}], "]"}], "-", 
                RowBox[{"emb", "[", 
                 RowBox[{"[", "#", "]"}], "]"}]}], ")"}]}], "&"}]}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"v", ",", "fakevertexlist"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"rightF", "[", "_", "]"}], ":=", "False"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"answers", "=", 
        RowBox[{
         RowBox[{"Reap", "[", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"!", 
               RowBox[{"rightF", "[", "e", "]"}]}], ",", 
              RowBox[{
               RowBox[{"s", "=", 
                RowBox[{"e", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"t", "=", 
                RowBox[{"e", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"initial", "=", "s"}], ";", "\[IndentingNewLine]", 
               RowBox[{"face", "=", 
                RowBox[{"{", "s", "}"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"While", "[", 
                RowBox[{
                 RowBox[{"t", "=!=", "initial"}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"rightF", "[", 
                    RowBox[{"UndirectedEdge", "[", 
                    RowBox[{"s", ",", "t"}], "]"}], "]"}], "=", "True"}], ";",
                   "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"s", ",", "t"}], "}"}], "=", 
                   RowBox[{"nextCandidate", "[", 
                    RowBox[{"s", ",", "t", ",", 
                    RowBox[{"pAdj", "[", "t", "]"}]}], "]"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"face", "=", 
                   RowBox[{"Join", "[", 
                    RowBox[{"face", ",", 
                    RowBox[{"{", "s", "}"}]}], "]"}]}], ";"}]}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"Sow", "[", "face", "]"}], ";"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"e", ",", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"EdgeList", "[", "g", "]"}], "/.", "tofakenums"}], 
               ")"}]}], "}"}]}], "]"}], "]"}], "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"answers", "\[Equal]", 
          RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"outputfaces", "=", 
           RowBox[{"answers", "/.", "torealnums"}]}], ";"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{
          RowBox[{"outputfaces", "=", 
           RowBox[{
            RowBox[{"answers", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "/.", "torealnums"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "outputfaces"}]}], "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeLoopsIndependent", "[", "internalfacenodes_", "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "indeploops", ",", "oppositeloops", ",", "tempindeploops", ",", 
         "outputinternalfacenodes"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"indeploops", "=", 
         RowBox[{"Gather", "[", 
          RowBox[{"internalfacenodes", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"Sort", "[", "#1", "]"}], "\[Equal]", 
             RowBox[{"Sort", "[", "#2", "]"}]}], "&"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"oppositeloops", "=", 
         RowBox[{"Sequence", "@@@", 
          RowBox[{"indeploops", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"2", ";;"}]}], "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tempindeploops", "=", 
         RowBox[{"Gather", "[", 
          RowBox[{
           RowBox[{"indeploops", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"SubsetQ", "[", 
              RowBox[{"#1", ",", "#2"}], "]"}], "||", 
             RowBox[{"SubsetQ", "[", 
              RowBox[{"#2", ",", "#1"}], "]"}]}], "&"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"indeploops", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Cases", "[", 
              RowBox[{"#", ",", 
               RowBox[{"zz_", "/;", 
                RowBox[{
                 RowBox[{"Length", "[", "zz", "]"}], "\[Equal]", 
                 RowBox[{"Min", "[", 
                  RowBox[{"Map", "[", 
                   RowBox[{"Length", ",", "#"}], "]"}], "]"}]}]}]}], "]"}], 
             "[", 
             RowBox[{"[", "1", "]"}], "]"}], "&"}], ",", "tempindeploops"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"outputinternalfacenodes", "=", 
         RowBox[{"DeleteCases", "[", 
          RowBox[{
           RowBox[{"Append", "[", 
            RowBox[{"indeploops", ",", 
             RowBox[{"Union", "[", 
              RowBox[{"Flatten", "[", 
               RowBox[{"{", 
                RowBox[{"oppositeloops", ",", 
                 RowBox[{"Sequence", "@@@", 
                  RowBox[{"MapThread", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Complement", "[", 
                    RowBox[{"#1", ",", 
                    RowBox[{"{", "#2", "}"}]}], "]"}], "&"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"tempindeploops", ",", "indeploops"}], "}"}]}], 
                   "]"}]}]}], "}"}], "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        "outputinternalfacenodes"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "===", "===", "===", "===", "===", "===", "===", "===", "===", "===", "===",
       "===", "===", "===", "==="}], "=", 
     RowBox[{
      RowBox[{
      "===", "===", "===", "===", "===", "===", "===", "===", "===", "===", 
       "==="}], "=", 
      RowBox[{"===", "===", "===", "===", "===", "===", "===", "=="}]}]}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "This", " ", "is", " ", "code", " ", "from", " ", "stackexchange", " ", 
      RowBox[{"http", ":"}]}], "//", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"mathematica", ".", "stackexchange", ".", "com"}], "/", 
         "questions"}], "/", "52056"}], "/", "dual"}], "-", "graph", "-", 
      "of", "-", "an", "-", "arbitrary", "-", "planar", "-", 
      RowBox[{
       RowBox[{"graph", "/", "52092"}], " ", "for", " ", "counting", " ", 
       "the", " ", "number", " ", "of", " ", "faces"}]}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "===", "===", "===", "===", "===", "===", "===", "===", "===", "===", "===",
       "===", "===", "===", "==="}], "=", 
     RowBox[{
      RowBox[{
      "===", "===", "===", "===", "===", "===", "===", "===", "===", "===", 
       "==="}], "=", 
      RowBox[{"===", "===", "===", "===", "===", "===", "===", "=="}]}]}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"simple", " ", 
     RowBox[{"Kruskal", "'"}], "s", " ", "algorithm", " ", "without", " ", 
     "sorting"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SpanningTree", "[", "graph_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"label", ",", 
         RowBox[{"edges", "=", 
          RowBox[{"EdgeList", "[", "graph", "]"}]}]}], "}"}], ",", 
       RowBox[{"Pick", "[", 
        RowBox[{"edges", ",", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"UnsameQ", "[", 
                RowBox[{"#1", ",", "#2"}], "]"}], ",", 
               RowBox[{
                RowBox[{"#2", "=", "#1"}], ";", "True"}], ",", "False"}], 
              "]"}], "&"}], "@@", 
            RowBox[{"Sort", "[", 
             RowBox[{"label", "/@", "edge"}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"edge", ",", "edges"}], "}"}]}], "]"}]}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"makeEges", "[", "list_", "]"}], ":=", 
    RowBox[{"Sort", "/@", 
     RowBox[{"UndirectedEdge", "@@@", 
      RowBox[{"Partition", "[", 
       RowBox[{"list", ",", "2", ",", "1"}], "]"}]}]}]}], "\n", 
   RowBox[{"(*", 
    RowBox[{"FindFace2", ":", 
     RowBox[{
      RowBox[{"finds", " ", "the", " ", "smallest", " ", 
       RowBox[{"cycle", ".", "This"}], " ", "cycle", " ", "is", " ", "a", " ",
        "pseudo"}], "-", 
      RowBox[{"face", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"FindFace2", "[", 
     RowBox[{"graph_", ",", "edges_"}], "]"}], ":=", 
    RowBox[{"MapAt", "[", 
     RowBox[{"makeEges", ",", 
      RowBox[{"First", "@", 
       RowBox[{"SortBy", "[", 
        RowBox[{
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"FindShortestPath", "[", 
               RowBox[{"graph", ",", 
                RowBox[{"Sequence", "@@", "#"}]}], "]"}], "&"}], "/@", 
             "edges"}], ",", "edges"}], "}"}], "]"}], ",", 
         RowBox[{"Composition", "[", 
          RowBox[{"Length", ",", "First"}], "]"}]}], "]"}]}], ",", "1"}], 
     "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Append", " ", "analyzed", " ", "edge", " ", "to", " ", "a", " ", 
     "graph"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"appendEge", "[", 
     RowBox[{"graph_", ",", "edge_"}], "]"}], ":=", 
    RowBox[{"Graph", "@", 
     RowBox[{"Append", "[", 
      RowBox[{
       RowBox[{"EdgeList", "[", "graph", "]"}], ",", "edge"}], "]"}]}]}], 
   "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"iteration", "[", 
      RowBox[{"graph_", ",", 
       RowBox[{"{", "}"}]}], "]"}], ":=", "$faces"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"iteration", "[", 
     RowBox[{"graph_", ",", "edges_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"iteration", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"AppendTo", "[", 
          RowBox[{"$faces", ",", 
           RowBox[{"Flatten", "[", "#", "]"}]}], "]"}], ";", 
         RowBox[{"appendEge", "[", 
          RowBox[{"graph", ",", 
           RowBox[{"Last", "@", "#"}]}], "]"}]}], ",", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{"edges", ",", 
          RowBox[{"Last", "@", "#"}]}], "]"}]}], "]"}], "&"}], "[", 
     RowBox[{"FindFace2", "[", 
      RowBox[{"graph", ",", "edges"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Faces", ":", 
     RowBox[{
      RowBox[{"returns", " ", "all", " ", "pseudo"}], "-", 
      RowBox[{"faces", " ", "of", " ", "a", " ", "graph"}]}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Faces", "[", "graph_", "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"$faces", "=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"tree", "=", 
         RowBox[{"SpanningTree", "[", "graph", "]"}]}]}], "}"}], ",", 
      RowBox[{"iteration", "[", 
       RowBox[{
        RowBox[{"Graph", "[", "tree", "]"}], ",", 
        RowBox[{"Complement", "[", 
         RowBox[{
          RowBox[{"EdgeList", "[", "graph", "]"}], ",", "tree"}], "]"}]}], 
       "]"}]}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "===", "===", "===", "===", "===", "===", "===", "===", "===", "===", "===",
       "===", "===", "===", "==="}], "=", 
     RowBox[{
      RowBox[{
      "===", "===", "===", "===", "===", "===", "===", "===", "===", "===", 
       "==="}], "=", 
      RowBox[{"===", "===", "===", "===", "===", "===", "===", "=="}]}]}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"allTestPlanarityQ", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"aa_", ",", "bb_", ",", "cc_", ",", "dd_"}], "}"}], ",", 
       "bftlabeling_"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "a", ",", "b", ",", "c", ",", "d", ",", "planaritycollapsed", ",", 
         "graph", ",", "externalnodes", ",", "choppedgraph", ",", 
         "connectedcomponents", ",", "internalfaces", ",", 
         "internalfacenodes", ",", "externaledges", ",", 
         "whichfacescouldyoubein", ",", "howmanyfacescanyoubein", ",", 
         "numcommonfaces"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"planaritycollapsed", "=", 
         RowBox[{"planarityQ", "[", 
          RowBox[{"aa", ",", "bb", ",", "cc", ",", "dd"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "b", ",", "c", ",", "d"}], "}"}], "=", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"aa", ",", "bb", ",", "cc", ",", "dd"}], "}"}], "//.", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "firstmat_", ",", "secondmat_", ",", "thirdmat_", ",", 
             "fourthmat_"}], "}"}], "\[RuleDelayed]", 
           RowBox[{"simplifyGraph", "[", 
            RowBox[{"firstmat", ",", 
             RowBox[{"(", 
              RowBox[{"secondmat", "/.", 
               RowBox[{"Map", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"#", "\[Rule]", "0"}], "&"}], ",", 
                 RowBox[{"Flatten", "[", 
                  RowBox[{"Map", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ";;"}], "]"}], "]"}], "&"}], ",", 
                    RowBox[{"Cases", "[", 
                    RowBox[{
                    RowBox[{"Map", "[", 
                    RowBox[{"Variables", ",", "secondmat"}], "]"}], ",", 
                    RowBox[{"zz_", "/;", 
                    RowBox[{
                    RowBox[{"Length", "[", "zz", "]"}], ">", "1"}]}]}], 
                    "]"}]}], "]"}], "]"}]}], "]"}]}], ")"}], ",", 
             RowBox[{
              RowBox[{"Function", "[", 
               RowBox[{
                RowBox[{"{", "thebottomleft", "}"}], ",", 
                RowBox[{"Block", "[", 
                 RowBox[{
                  RowBox[{"{", "output", "}"}], ",", 
                  RowBox[{
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "thebottomleft", "]"}], ">", "0"}],
                     ",", 
                    RowBox[{
                    RowBox[{"output", "=", 
                    RowBox[{"thebottomleft", "/.", 
                    RowBox[{"Map", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "\[Rule]", "0"}], "&"}], ",", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Map", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ";;"}], "]"}], "]"}], "&"}], ",", 
                    RowBox[{"Cases", "[", 
                    RowBox[{
                    RowBox[{"Map", "[", 
                    RowBox[{"Variables", ",", 
                    RowBox[{"Transpose", "[", "thebottomleft", "]"}]}], "]"}],
                     ",", 
                    RowBox[{"zz_", "/;", 
                    RowBox[{
                    RowBox[{"Length", "[", "zz", "]"}], ">", "1"}]}]}], 
                    "]"}]}], "]"}], "]"}]}], "]"}]}]}], ";"}], ",", 
                    RowBox[{
                    RowBox[{"output", "=", "thebottomleft"}], ";"}]}], "]"}], 
                   ";", "output"}]}], "]"}]}], "]"}], "[", "thirdmat", "]"}], 
             ",", "fourthmat"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"graph", "=", 
         RowBox[{"turnIntoGraph", "[", 
          RowBox[{"a", ",", "b", ",", "c", ",", "d", ",", "False"}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"PlanarGraphQ", "[", "graph", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"externalnodes", "=", 
            RowBox[{"getOrderingExternalNodesDefault", "[", 
             RowBox[{"a", ",", "b", ",", "c", ",", "d"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"choppedgraph", "=", 
            RowBox[{"Graph", "[", 
             RowBox[{
              RowBox[{"turnIntoGraph", "[", 
               RowBox[{
                RowBox[{"Sequence", "@@", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"a", ",", "b", ",", "c", ",", "d"}], "}"}], "/.", 
                   RowBox[{"Map", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "\[Rule]", "0"}], "&"}], ",", 
                    RowBox[{"Variables", "[", 
                    RowBox[{"{", 
                    RowBox[{"b", ",", "c"}], "}"}], "]"}]}], "]"}]}], ")"}]}],
                 ",", "False"}], "]"}], ",", 
              RowBox[{"GraphLayout", "\[Rule]", "\"\<PlanarEmbedding\>\""}]}],
              "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"connectedcomponents", "=", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Subgraph", "[", 
                RowBox[{"choppedgraph", ",", "#"}], "]"}], "&"}], ",", 
              RowBox[{"DeleteCases", "[", 
               RowBox[{
                RowBox[{"ConnectedComponents", "[", "choppedgraph", "]"}], 
                ",", 
                RowBox[{"{", 
                 RowBox[{"Alternatives", "@@", "externalnodes"}], "}"}]}], 
               "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"internalfacenodes", "=", 
            RowBox[{"DeleteCases", "[", 
             RowBox[{
              RowBox[{"Map", "[", 
               RowBox[{"FindFace", ",", "connectedcomponents"}], "]"}], ",", 
              RowBox[{"zz_", "/;", 
               RowBox[{
                RowBox[{"Length", "[", "zz", "]"}], "\[LessEqual]", "1"}]}]}],
              "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"internalfacenodes", "=", 
            RowBox[{"DeleteCases", "[", 
             RowBox[{
              RowBox[{"Append", "[", 
               RowBox[{
                RowBox[{"Join", "@@", 
                 RowBox[{"internalfacenodes", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", 
                    RowBox[{";;", 
                    RowBox[{"-", "2"}]}]}], "]"}], "]"}]}], ",", 
                RowBox[{"Join", "@@", 
                 RowBox[{"internalfacenodes", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", 
                    RowBox[{"-", "1"}]}], "]"}], "]"}]}]}], "]"}], ",", 
              RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"internalfacenodes", "=", 
            RowBox[{"makeLoopsIndependent", "[", "internalfacenodes", "]"}]}],
            ";", "\[IndentingNewLine]", 
           RowBox[{"externaledges", "=", 
            RowBox[{"Cases", "[", 
             RowBox[{
              RowBox[{"EdgeList", "[", "graph", "]"}], ",", 
              RowBox[{
               RowBox[{"UndirectedEdge", "[", 
                RowBox[{
                 RowBox[{"Alternatives", "@@", "externalnodes"}], ",", "_"}], 
                "]"}], "|", 
               RowBox[{"UndirectedEdge", "[", 
                RowBox[{"_", ",", 
                 RowBox[{"Alternatives", "@@", "externalnodes"}]}], "]"}]}]}],
              "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"whichfacescouldyoubein", "=", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"DeleteDuplicates", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"#", "/.", 
                   RowBox[{
                    RowBox[{"{", "}"}], "\[Rule]", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"ii", ",", "ii"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"ii", ",", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "internalfacenodes", "]"}], "/.", 
                    RowBox[{"{", 
                    RowBox[{"0", "\[Rule]", "1"}], "}"}]}], ")"}]}], "}"}]}], 
                    "]"}]}]}], ")"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "&"}], ",", 
              RowBox[{"Map", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Position", "[", 
                  RowBox[{"internalfacenodes", ",", 
                   RowBox[{"Alternatives", "@@", "#"}]}], "]"}], "&"}], ",", 
                "externaledges"}], "]"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"whichfacescouldyoubein", "\[Equal]", 
              RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"numcommonfaces", "=", "1"}], ";"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{
              RowBox[{"numcommonfaces", "=", 
               RowBox[{"Length", "[", 
                RowBox[{"Intersection", "@@", "whichfacescouldyoubein"}], 
                "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"planaritycollapsed", "===", "True"}], "&&", 
                RowBox[{"numcommonfaces", "\[Equal]", "0"}]}], ")"}], "||", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"planaritycollapsed", "=!=", "True"}], "&&", 
                RowBox[{"numcommonfaces", "\[GreaterEqual]", "1"}]}], ")"}]}],
              ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"\"\<Warning: first algorithm failed. kast=\>\"", ",", 
                RowBox[{"{", 
                 RowBox[{"a", ",", "b", ",", "c", ",", "d"}], "}"}]}], "]"}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
               "Recompute", " ", "the", " ", "faces", " ", "using", " ", 
                "the", " ", "alternative", " ", 
                RowBox[{"method", "!"}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"externalnodes", "=", 
               RowBox[{"getOrderingExternalNodesDefault", "[", 
                RowBox[{"a", ",", "b", ",", "c", ",", "d"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"internalfaces", "=", 
               RowBox[{"Faces", "[", 
                RowBox[{"Graph", "[", 
                 RowBox[{"graph", ",", 
                  RowBox[{
                  "GraphLayout", "\[Rule]", "\"\<PlanarEmbedding\>\""}]}], 
                 "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"internalfacenodes", "=", 
               RowBox[{"Map", "[", 
                RowBox[{"Union", ",", 
                 RowBox[{"internalfaces", "/.", 
                  RowBox[{"UndirectedEdge", "\[Rule]", "Sequence"}]}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"externaledges", "=", 
               RowBox[{"Cases", "[", 
                RowBox[{
                 RowBox[{"EdgeList", "[", "graph", "]"}], ",", 
                 RowBox[{
                  RowBox[{"UndirectedEdge", "[", 
                   RowBox[{
                    RowBox[{"Alternatives", "@@", "externalnodes"}], ",", 
                    "_"}], "]"}], "|", 
                  RowBox[{"UndirectedEdge", "[", 
                   RowBox[{"_", ",", 
                    RowBox[{"Alternatives", "@@", "externalnodes"}]}], 
                   "]"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"whichfacescouldyoubein", "=", 
               RowBox[{"Map", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"DeleteDuplicates", "[", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"#", "/.", 
                    RowBox[{
                    RowBox[{"{", "}"}], "\[Rule]", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"ii", ",", "ii"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"ii", ",", 
                    RowBox[{"Length", "[", "internalfaces", "]"}]}], "}"}]}], 
                    "]"}]}]}], ")"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "&"}], 
                 ",", 
                 RowBox[{"Map", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{"internalfacenodes", ",", 
                    RowBox[{"Alternatives", "@@", "#"}]}], "]"}], "&"}], ",", 
                   "externaledges"}], "]"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"howmanyfacescanyoubein", "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"VertexDegree", "[", "graph", "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"Flatten", "[", 
                   RowBox[{"externaledges", "/.", 
                    RowBox[{
                    RowBox[{"UndirectedEdge", "[", 
                    RowBox[{"v1_Integer", ",", "v2_Integer"}], "]"}], 
                    "\[RuleDelayed]", 
                    RowBox[{"DeleteCases", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"v1", ",", "v2"}], "}"}], ",", 
                    RowBox[{"Alternatives", "@@", "externalnodes"}]}], 
                    "]"}]}]}], "]"}], "]"}], "]"}], "-", "1"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"whichfacescouldyoubein", "=", 
               RowBox[{"DeleteCases", "[", 
                RowBox[{
                 RowBox[{"MapThread", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"PadRight", "[", 
                    RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    "whichfacescouldyoubein", ",", "howmanyfacescanyoubein"}],
                     "}"}]}], "]"}], ",", 
                 RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"whichfacescouldyoubein", "\[Equal]", 
                 RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"numcommonfaces", "=", "1"}], ";"}], 
                "\[IndentingNewLine]", ",", 
                RowBox[{
                 RowBox[{"numcommonfaces", "=", 
                  RowBox[{"Length", "[", 
                   RowBox[{"Intersection", "@@", "whichfacescouldyoubein"}], 
                   "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"planaritycollapsed", "===", "True"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"numcommonfaces", "\[Equal]", "0"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Print", "[", 
                  RowBox[{"\"\<kast=\>\"", ",", 
                   RowBox[{"{", 
                    RowBox[{"a", ",", "b", ",", "c", ",", "d"}], "}"}], ",", 
                   "\"\< : There's a problem with planarityQ! We are on genus \
zero on a graph declared planar, and yet we don't have that B=1.\>\""}], 
                  "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"numcommonfaces", "\[GreaterEqual]", "1"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Print", "[", 
                  RowBox[{"\"\<kast=\>\"", ",", 
                   RowBox[{"{", 
                    RowBox[{"a", ",", "b", ",", "c", ",", "d"}], "}"}], ",", 
                   "\"\< : There's a problem with planarityQ! We are on genus \
zero on a graph declared nonplanar, and yet we have that B=1.\>\""}], "]"}], 
                 ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"planaritycollapsed", "=!=", "False"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"\"\<kast=\>\"", ",", 
                RowBox[{"{", 
                 RowBox[{"a", ",", "b", ",", "c", ",", "d"}], "}"}], ",", 
                "\"\< : There's a problem with planarityQ! When we don't \
collapse bivalent nodes, it gives that this example is planar even though it \
can't even be embedded on genus zero.\>\""}], "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
         "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DistributeDefinitions", "[", "allTestPlanarityQ", "]"}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.687515705982732*^9, 3.687515739851569*^9}, {
   3.6875157760283637`*^9, 3.687515779791551*^9}, 3.6875159489901147`*^9, {
   3.687516148047002*^9, 3.6875161502748933`*^9}, {3.68751903371249*^9, 
   3.687519042865605*^9}, {3.6875190801038055`*^9, 3.6875190914460974`*^9}, 
   3.6875196814560356`*^9, 3.6875198327355633`*^9, {3.6875228375914917`*^9, 
   3.687522898955289*^9}, {3.6875232754560323`*^9, 3.687523291166*^9}, 
   3.6875237028728943`*^9, {3.6875241146877403`*^9, 3.6875241255571136`*^9}, {
   3.687524465170884*^9, 3.6875244691256523`*^9}, {3.6875871876691923`*^9, 
   3.6875871882786083`*^9}, {3.6875872380024137`*^9, 3.687587238361794*^9}, {
   3.68758782040048*^9, 3.6875879104596033`*^9}, {3.6875879915693846`*^9, 
   3.687588101252739*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ParallelMap", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"allTestPlanarityQ", "[", 
      RowBox[{"#", ",", "True"}], "]"}], "&"}], ",", 
    RowBox[{"Cases", "[", 
     RowBox[{"annoyingsmallexamples", ",", 
      RowBox[{"zz_", "/;", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"perfectMatchings", "@@", "zz"}], ")"}], "\[NotEqual]", 
        RowBox[{"{", "}"}]}]}]}], "]"}]}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.6875198723503547`*^9, 3.687519875836772*^9}, 
   3.6875245879189672`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ParallelMap", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"allTestPlanarityQ", "[", 
      RowBox[{"#", ",", "True"}], "]"}], "&"}], ",", "allbft1kasteleyns"}], 
   "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.68751988557037*^9, 3.687519895692232*^9}, {
  3.687524498596073*^9, 3.6875245090579877`*^9}, {3.687524579993471*^9, 
  3.6875245810175366`*^9}, {3.687587203074241*^9, 3.687587211798421*^9}, {
  3.6875873264436007`*^9, 3.6875873471619673`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ParallelMap", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"allTestPlanarityQ", "[", 
      RowBox[{"#", ",", "Null"}], "]"}], "&"}], ",", "allbft2kasteleyns"}], 
   "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.6875245222860727`*^9, 3.6875245955327215`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ParallelMap", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"allTestPlanarityQ", "[", 
      RowBox[{"#", ",", "False"}], "]"}], "&"}], ",", 
    "allscatteringkasteleyns"}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.687524549881817*^9, 3.687524567503231*^9}, {
  3.6875245993947444`*^9, 3.6875246003320465`*^9}}],

Cell[BoxData[
 RowBox[{"allTestPlanarityQ", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", "}"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", 
        RowBox[{"X", "[", 
         RowBox[{"2", ",", "3"}], "]"}]}], "}"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"{", "}"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0"}], "}"}], "}"}]}], "}"}], ",", 
   "Null"}], "]"}]], "Input",
 CellChangeTimes->{{3.687591076738308*^9, 3.6875910853101645`*^9}}],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.687525602805124*^9, 3.687525602852005*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"aa", ",", "bb", ",", "cc", ",", "dd"}], "}"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", "}"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", 
        RowBox[{"X", "[", 
         RowBox[{"2", ",", "3"}], "]"}]}], "}"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"{", "}"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0"}], "}"}], "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"planaritycollapsed", "=", 
   RowBox[{"planarityQ", "[", 
    RowBox[{"aa", ",", "bb", ",", "cc", ",", "dd"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"a", ",", "b", ",", "c", ",", "d"}], "}"}], "=", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"aa", ",", "bb", ",", "cc", ",", "dd"}], "}"}], "//.", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "firstmat_", ",", "secondmat_", ",", "thirdmat_", ",", "fourthmat_"}], 
      "}"}], "\[RuleDelayed]", 
     RowBox[{"simplifyGraph", "[", 
      RowBox[{"firstmat", ",", 
       RowBox[{"(", 
        RowBox[{"secondmat", "/.", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "\[Rule]", "0"}], "&"}], ",", 
           RowBox[{"Flatten", "[", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", 
                 RowBox[{"2", ";;"}], "]"}], "]"}], "&"}], ",", 
              RowBox[{"Cases", "[", 
               RowBox[{
                RowBox[{"Map", "[", 
                 RowBox[{"Variables", ",", "secondmat"}], "]"}], ",", 
                RowBox[{"zz_", "/;", 
                 RowBox[{
                  RowBox[{"Length", "[", "zz", "]"}], ">", "1"}]}]}], "]"}]}],
              "]"}], "]"}]}], "]"}]}], ")"}], ",", 
       RowBox[{
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", "thebottomleft", "}"}], ",", 
          RowBox[{"Block", "[", 
           RowBox[{
            RowBox[{"{", "output", "}"}], ",", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", "thebottomleft", "]"}], ">", "0"}], 
               ",", 
               RowBox[{
                RowBox[{"output", "=", 
                 RowBox[{"thebottomleft", "/.", 
                  RowBox[{"Map", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"#", "\[Rule]", "0"}], "&"}], ",", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Map", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ";;"}], "]"}], "]"}], "&"}], ",", 
                    RowBox[{"Cases", "[", 
                    RowBox[{
                    RowBox[{"Map", "[", 
                    RowBox[{"Variables", ",", 
                    RowBox[{"Transpose", "[", "thebottomleft", "]"}]}], "]"}],
                     ",", 
                    RowBox[{"zz_", "/;", 
                    RowBox[{
                    RowBox[{"Length", "[", "zz", "]"}], ">", "1"}]}]}], 
                    "]"}]}], "]"}], "]"}]}], "]"}]}]}], ";"}], ",", 
               RowBox[{
                RowBox[{"output", "=", "thebottomleft"}], ";"}]}], "]"}], ";",
              "output"}]}], "]"}]}], "]"}], "[", "thirdmat", "]"}], ",", 
       "fourthmat"}], "]"}]}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"graph", "=", 
   RowBox[{"turnIntoGraph", "[", 
    RowBox[{"a", ",", "b", ",", "c", ",", "d", ",", "False"}], "]"}]}], ";"}],
 "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"externalnodes", "=", 
    RowBox[{"getOrderingExternalNodesDefault", "[", 
     RowBox[{"a", ",", "b", ",", "c", ",", "d"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"choppedgraph", "=", 
  RowBox[{"Graph", "[", 
   RowBox[{
    RowBox[{"turnIntoGraph", "[", 
     RowBox[{
      RowBox[{"Sequence", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "b", ",", "c", ",", "d"}], "}"}], "/.", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "\[Rule]", "0"}], "&"}], ",", 
           RowBox[{"Variables", "[", 
            RowBox[{"{", 
             RowBox[{"b", ",", "c"}], "}"}], "]"}]}], "]"}]}], ")"}]}], ",", 
      "False"}], "]"}], ",", 
    RowBox[{"GraphLayout", "\[Rule]", "\"\<PlanarEmbedding\>\""}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"connectedcomponents", "=", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Subgraph", "[", 
      RowBox[{"choppedgraph", ",", "#"}], "]"}], "&"}], ",", 
    RowBox[{"DeleteCases", "[", 
     RowBox[{
      RowBox[{"ConnectedComponents", "[", "choppedgraph", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"Alternatives", "@@", "externalnodes"}], "}"}]}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"internalfacenodes", "=", 
  RowBox[{"DeleteCases", "[", 
   RowBox[{
    RowBox[{"Map", "[", 
     RowBox[{"FindFace", ",", "connectedcomponents"}], "]"}], ",", 
    RowBox[{"zz_", "/;", 
     RowBox[{
      RowBox[{"Length", "[", "zz", "]"}], "\[LessEqual]", "1"}]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"internalfacenodes", "=", 
  RowBox[{"DeleteCases", "[", 
   RowBox[{
    RowBox[{"Append", "[", 
     RowBox[{
      RowBox[{"Join", "@@", 
       RowBox[{"internalfacenodes", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{";;", 
           RowBox[{"-", "2"}]}]}], "]"}], "]"}]}], ",", 
      RowBox[{"Join", "@@", 
       RowBox[{"internalfacenodes", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"-", "1"}]}], "]"}], "]"}]}]}], "]"}], ",", 
    RowBox[{"{", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"internalfacenodes", "=", 
    RowBox[{"makeLoopsIndependent", "[", "internalfacenodes", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"externaledges", "=", 
   RowBox[{"Cases", "[", 
    RowBox[{
     RowBox[{"EdgeList", "[", "graph", "]"}], ",", 
     RowBox[{
      RowBox[{"UndirectedEdge", "[", 
       RowBox[{
        RowBox[{"Alternatives", "@@", "externalnodes"}], ",", "_"}], "]"}], 
      "|", 
      RowBox[{"UndirectedEdge", "[", 
       RowBox[{"_", ",", 
        RowBox[{"Alternatives", "@@", "externalnodes"}]}], "]"}]}]}], "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{"whichfacescouldyoubein", "=", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"DeleteDuplicates", "[", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"#", "/.", 
         RowBox[{
          RowBox[{"{", "}"}], "\[Rule]", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"ii", ",", "ii"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"ii", ",", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Length", "[", "internalfacenodes", "]"}], "/.", 
                RowBox[{"{", 
                 RowBox[{"0", "\[Rule]", "1"}], "}"}]}], ")"}]}], "}"}]}], 
           "]"}]}]}], ")"}], "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "&"}], ",", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Position", "[", 
        RowBox[{"internalfacenodes", ",", 
         RowBox[{"Alternatives", "@@", "#"}]}], "]"}], "&"}], ",", 
      "externaledges"}], "]"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.6875871654832397`*^9, 3.687587172346899*^9}, {
  3.68759101461344*^9, 3.6875910599331436`*^9}}],

Cell[BoxData[
 GraphicsBox[
  NamespaceBox["NetworkGraphics",
   DynamicModuleBox[{Typeset`graph = HoldComplete[
     Graph[{1, 2, 3, 4, 5}, {}, {
      GraphLayout -> {"Dimension" -> 2, "VertexLayout" -> "PlanarEmbedding"}, 
       ImagePadding -> 20, VertexLabels -> {"Name"}, VertexLabelStyle -> {15},
        VertexSize -> {Medium}, 
       VertexStyle -> {
        4 -> GrayLevel[0], 1 -> GrayLevel[1], 2 -> GrayLevel[1], 3 -> 
         GrayLevel[0], 5 -> GrayLevel[0]}}]]}, 
    TagBox[GraphicsGroupBox[{{}, 
       {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[0.7]}], {
         {GrayLevel[1], DiskBox[{0.00001, -0.00005}, 2.*^-6]}, InsetBox[
          StyleBox["1",
           StripOnInput->False,
           FontSize->15], Offset[{2, 2}, {0.000012, -0.000048}], ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         {GrayLevel[1], DiskBox[{0.00001, -0.00001}, 2.*^-6]}, InsetBox[
          StyleBox["2",
           StripOnInput->False,
           FontSize->15], Offset[{2, 2}, {0.000012, -8.000000000000001*^-6}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         {GrayLevel[0], 
          DiskBox[{0.00001, -0.000030000000000000004`}, 2.*^-6]}, InsetBox[
          StyleBox["3",
           StripOnInput->False,
           FontSize->15], 
          Offset[{2, 2}, {0.000012, -0.000028000000000000003`}], ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         {GrayLevel[0], 
          DiskBox[{0.000030000000000000004`, -0.00001}, 2.*^-6]}, InsetBox[
          StyleBox["4",
           StripOnInput->False,
           FontSize->15], 
          Offset[{2, 2}, {0.000032000000000000005`, -8.000000000000001*^-6}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         {GrayLevel[0], 
          DiskBox[{0.000030000000000000004`, -0.000030000000000000004`}, 
           2.*^-6]}, InsetBox[
          StyleBox["5",
           StripOnInput->False,
           FontSize->15], 
          Offset[{2, 2}, \
{0.000032000000000000005`, -0.000028000000000000003`}], ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}}}],
     MouseAppearanceTag["NetworkGraphics"]],
    AllowKernelInitialization->False]],
  DefaultBaseStyle->{
   "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
  FrameTicks->None,
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImagePadding->20]], "Output",
 CellChangeTimes->{3.6875256054639225`*^9, 3.687586830715637*^9, 
  3.687586909897928*^9, 3.6875869409402266`*^9, 3.6875869957898335`*^9, 
  3.687587172847028*^9, 3.6875910608237953`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  GraphicsBox[
   NamespaceBox["NetworkGraphics",
    DynamicModuleBox[{Typeset`graph = HoldComplete[
      Graph[{1}, {}]]}, 
     TagBox[GraphicsGroupBox[GraphicsComplexBox[{{0., 0.}}, {{}, 
         {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[0.7]}], 
          DiskBox[1, 0.004014598540145964]}}]],
      MouseAppearanceTag["NetworkGraphics"]],
     AllowKernelInitialization->False]],
   DefaultBaseStyle->{
    "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
   FrameTicks->None,
   GridLinesStyle->Directive[
     GrayLevel[0.5, 0.4]],
   PlotRangePadding->0.1], "}"}]], "Output",
 CellChangeTimes->{3.6875256054639225`*^9, 3.687586830715637*^9, 
  3.687586909897928*^9, 3.6875869409402266`*^9, 3.6875869957898335`*^9, 
  3.687587172847028*^9, 3.687591060855045*^9}],

Cell[BoxData[
 RowBox[{"{", "}"}]], "Output",
 CellChangeTimes->{3.6875256054639225`*^9, 3.687586830715637*^9, 
  3.687586909897928*^9, 3.6875869409402266`*^9, 3.6875869957898335`*^9, 
  3.687587172847028*^9, 3.6875910608706713`*^9}],

Cell[BoxData[
 RowBox[{"{", "}"}]], "Output",
 CellChangeTimes->{3.6875256054639225`*^9, 3.687586830715637*^9, 
  3.687586909897928*^9, 3.6875869409402266`*^9, 3.6875869957898335`*^9, 
  3.687587172847028*^9, 3.6875910608706713`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", "1", "}"}], "}"}]], "Output",
 CellChangeTimes->{3.6875256054639225`*^9, 3.687586830715637*^9, 
  3.687586909897928*^9, 3.6875869409402266`*^9, 3.6875869957898335`*^9, 
  3.687587172847028*^9, 3.6875910608862963`*^9}]
}, Open  ]],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.687587083903886*^9, 3.687587149695916*^9}, 
   3.6875871838233814`*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"makeLoopsIndependent", "[", "internalfacenodes", "]"}]], "Input",
 CellChangeTimes->{{3.687587157504548*^9, 3.687587159201462*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "8", ",", "2", ",", "9"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"10", ",", "3", ",", "11", ",", "4"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "1", ",", "2", ",", "3", ",", "4", ",", "8", ",", "9", ",", "10", ",", 
     "11"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.6875871594514503`*^9}]
}, Open  ]]
},
WindowSize->{1366, 685},
WindowMargins->{{-8, Automatic}, {Automatic, -8}},
FrontEndVersion->"10.2 for Microsoft Windows (64-bit) (July 7, 2015)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 35929, 858, 2452, "Input"],
Cell[36490, 880, 547, 15, 31, "Input"],
Cell[37040, 897, 489, 11, 31, "Input"],
Cell[37532, 910, 293, 8, 31, "Input"],
Cell[37828, 920, 350, 9, 31, "Input"],
Cell[38181, 931, 579, 18, 31, "Input"],
Cell[38763, 951, 146, 2, 72, "Input"],
Cell[CellGroupData[{
Cell[38934, 957, 7883, 221, 452, "Input"],
Cell[46820, 1180, 2584, 58, 447, "Output"],
Cell[49407, 1240, 837, 19, 197, "Output"],
Cell[50247, 1261, 233, 4, 31, "Output"],
Cell[50483, 1267, 233, 4, 31, "Output"],
Cell[50719, 1273, 261, 5, 31, "Output"]
}, Open  ]],
Cell[50995, 1281, 120, 2, 31, "Input"],
Cell[CellGroupData[{
Cell[51140, 1287, 155, 2, 31, "Input"],
Cell[51298, 1291, 389, 11, 31, "Output"]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
